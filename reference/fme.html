<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Computes FMEs. — fme • fmeffects</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Computes FMEs. — fme"><meta name="description" content="This is a wrapper function for FME$new(...)$compute().
It computes forward marginal effects (FMEs) for a specified change in feature values."><meta property="og:description" content="This is a wrapper function for FME$new(...)$compute().
It computes forward marginal effects (FMEs) for a specified change in feature values."><meta property="og:image" content="https://holgstr.github.io/fmeffects/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmeffects</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/fmeffects.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/fme_theory.html">Why FMEs?</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/holgstr/fmeffects/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Computes FMEs.</h1>
      <small class="dont-index">Source: <a href="https://github.com/holgstr/fmeffects/blob/master/R/FME.R" class="external-link"><code>R/FME.R</code></a></small>
      <div class="d-none name"><code>fme.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is a wrapper function for <code>FME$new(...)$compute()</code>.
It computes forward marginal effects (FMEs) for a specified change in feature values.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fme</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">features</span>,</span>
<span>  ep.method <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  compute.nlm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nlm.intervals <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The (trained) model, with the ability to predict on new data. This must be a <code>train.formula</code> (<code>tidymodels</code>), <code>Learner</code> (<code>mlr3</code>), <code>train</code> (<code>caret</code>), <code>lm</code> or <code>glm</code> object.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The data used for computing FMEs, must be data.frame or data.table.</p></dd>


<dt id="arg-features">features<a class="anchor" aria-label="anchor" href="#arg-features"></a></dt>
<dd><p>A named list with the feature name(s) and step size(s). The list names should correspond to the names of the feature variables affected by the step.
The list must exclusively contain either numeric or categorical features, but not a combination of both.
Numeric features must have a number as step size, categorical features the name of the reference category.</p></dd>


<dt id="arg-ep-method">ep.method<a class="anchor" aria-label="anchor" href="#arg-ep-method"></a></dt>
<dd><p>String specifying the method used for extrapolation detection. One of <code>"none"</code> or <code>"envelope"</code>. Defaults to <code>"none"</code>.</p></dd>


<dt id="arg-compute-nlm">compute.nlm<a class="anchor" aria-label="anchor" href="#arg-compute-nlm"></a></dt>
<dd><p>Compute NLMs for FMEs for numerical steps. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-nlm-intervals">nlm.intervals<a class="anchor" aria-label="anchor" href="#arg-nlm-intervals"></a></dt>
<dd><p>Number of intervals for computing NLMs. Results in longer computing time but more accurate approximation of NLMs. Defaults to <code>1</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>ForwardsMarginalEffect</code> object with the following fields:</p><ul><li><p><code>ame</code> average marginal effect (AME).</p></li>
<li><p><code>anlm</code> average non-linearity measure (NLM).</p></li>
<li><p><code>extrapolation.ids</code> observations that have been identified as extrapolation points and not included in the analysis.</p></li>
<li><p><code>data.step</code>, a <code>data.table</code> of the feature matrix after the step has been applied.</p></li>
<li><p><code>results</code>, a <code>data.table</code> of the individual FMEs (and NLMs, if applicable) for all observations that are not extrapolation points.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If one or more numeric features are passed to the <code>features</code> argument, FMEs are computed as $$FME_{x, h_{S}} = f(x + h_{S}, x_{-S}) - f(x)$$ where \(h_{S}\) is the step size vector and \(x_{-S}\) the other features.
If one or more categorical features are passed to <code>features</code>, $$FME_{x, c_{J}} = f(c_{J}, x_{-J}) - f(x)$$ where \(c_{J}\) is the set of selected reference categories in <code>features</code> and \(x_{-J}\) the other features.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Scholbeck, C.A., Casalicchio, G., Molnar, C. et al. Marginal effects for non-linear prediction functions. Data Min Knowl Disc (2024). https://doi.org/10.1007/s10618-023-00993-x</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Train a model:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3verse.mlr-org.com" class="external-link">mlr3verse</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://imbs-hl.github.io/ranger/" class="external-link">ranger</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bikes</span>, package <span class="op">=</span> <span class="st">"fmeffects"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">forest</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.ranger"</span><span class="op">)</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_task_regr.html" class="external-link">as_task_regr</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bikes</span>, target <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute FMEs for a numerical feature:</span></span></span>
<span class="r-in"><span><span class="va">effects</span> <span class="op">=</span> <span class="fu">fme</span><span class="op">(</span>model <span class="op">=</span> <span class="va">forest</span>, data <span class="op">=</span> <span class="va">bikes</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"temp"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, ep.method <span class="op">=</span> <span class="st">"envelope"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Analyze results:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">effects</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Forward Marginal Effects Object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Step type:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   numerical</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Features &amp; step lengths:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   temp, 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Extrapolation point detection:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   envelope, EPs: 3 of 731 obs. (0 %)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average Marginal Effect (AME):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   56.4042</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">effects</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</span>
<span class="r-plt img"><img src="fme-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract results:</span></span></span>
<span class="r-in"><span><span class="va">effects</span><span class="op">$</span><span class="va">results</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Key: &lt;obs.id&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      obs.id          fme</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       &lt;int&gt;        &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1:      1 158.72019394</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2:      2 253.46725238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3:      3  58.70801567</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4:      4  87.22350480</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   5:      5 218.24698054</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ---                    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 724:    727 304.61168137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 725:    728 222.42089939</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 726:    729 383.51970424</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 727:    730 434.09039495</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 728:    731  -0.09944615</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute the AME for a categorial feature:</span></span></span>
<span class="r-in"><span><span class="fu">fme</span><span class="op">(</span>model <span class="op">=</span> <span class="va">forest</span>, data <span class="op">=</span> <span class="va">bikes</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"weather"</span> <span class="op">=</span> <span class="st">"rain"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">ame</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -786.9927</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Holger Löwe, Christian Scholbeck.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

