<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Why FMEs? ‚Ä¢ fmeffects</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Why FMEs?">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmeffects</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/fmeffects.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fme_theory.html">Why FMEs?</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/holgstr/fmeffects/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Why FMEs?</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/holgstr/fmeffects/blob/master/vignettes/fme_theory.Rmd" class="external-link"><code>vignettes/fme_theory.Rmd</code></a></small>
      <div class="d-none name"><code>fme_theory.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="intuition">Intuition<a class="anchor" aria-label="anchor" href="#intuition"></a>
</h2>
<p>Forward Marginal Effects (FMEs) are probably the most intuitive way
to interpret feature effects in supervised ML models. Remember how we
interpret the beta coefficient of a numerical feature in a linear
regression model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msub><mi>Œ≤</mi><mn>0</mn></msub><mo>+</mo><msub><mi>Œ≤</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mi>‚Ä¶</mi><mo>+</mo><msub><mi>Œ≤</mi><mi>p</mi></msub><msub><mi>x</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">\mathbb{E}[Y] = \beta_{0} + \beta_{1}x_{1} + \ldots + \beta_{p}x_{p}</annotation></semantics></math>:<br></p>
<p><strong><em>If</em></strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_{j}</annotation></semantics></math><strong><em>increases by one unit, the predicted target variable
increases by</em></strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\beta_{j}</annotation></semantics></math>.<br></p>
<p>FMEs make use of this instinct and apply it straightforwardly to any
model.<br>
In short, FMEs are the answer to the following question:<br></p>
<p><strong><em>What is the change in the predicted target variable if we
change the value of the feature by</em></strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math><strong><em>units?</em></strong><br></p>
<p>A few examples: <em>What is the change in predicted blood pressure if
a patients‚Äô weight increases by</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math><em>= 1 kg? What is the change in predicted life satisfaction if a
person‚Äôs monthly income increases by</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math><em>= 1,000 US dollars?</em> Per default,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
will be 1. However,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
can be chosen to match the desired scale of interpretation.</p>
<hr>
</div>
<div class="section level2">
<h2 id="compute-effects">Compute Effects<a class="anchor" aria-label="anchor" href="#compute-effects"></a>
</h2>
<p>The big advantage of FMEs is that they are very simple. The FME is
defined observation-wise, i.e., it is computed separately for each
observation in the data. Often, we are more interested in estimating a
global effect, so we do the following:<br></p>
<p><strong>1. Compute the FME for each observation in the
data</strong><br><strong>2. Compute the Average Marginal Effect (AME)</strong><br></p>
<div class="section level3">
<h3 id="numerical-features">Numerical Features<a class="anchor" aria-label="anchor" href="#numerical-features"></a>
</h3>
<div class="section level4">
<h4 id="univariate-feature-effects">Univariate Feature Effects<a class="anchor" aria-label="anchor" href="#univariate-feature-effects"></a>
</h4>
<p>For a given observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and step size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>j</mi></msub><annotation encoding="application/x-tex">h_{j}</annotation></semantics></math>,
the FME of a single numerical feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_{j}</annotation></semantics></math>
is computed as:<br><br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">FME</mtext><mrow><msup><mi>ùê±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><mspace width="0.167em"></mspace><msub><mi>h</mi><mi>j</mi></msub></mrow></msub><mo>=</mo><mover><mi>f</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>x</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>,</mo><mspace width="0.167em"></mspace><mi>‚Ä¶</mi><mo>,</mo><mspace width="0.167em"></mspace><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>+</mo><msub><mi>h</mi><mi>j</mi></msub><mo>,</mo><mspace width="0.167em"></mspace><mi>‚Ä¶</mi><mo>,</mo><mspace width="0.167em"></mspace><msubsup><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mover><mi>f</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ùê±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\textrm{FME}_{\mathbf{x}^{(i)}, \, h_{j}} = \widehat{f}(x_{1}^{(i)},\, \ldots, \, x_{j}^{(i)}+h_{j},\, \ldots, \, x_{p}^{(i)})-\widehat{f}(\mathbf{x}^{(i)})</annotation></semantics></math><br></p>
<p>As can be seen from the formula, the FME is simply the difference in
predictions between the original observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">x^{(i)}</annotation></semantics></math>
and the changed observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>x</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>,</mo><mspace width="0.167em"></mspace><mi>‚Ä¶</mi><mo>,</mo><mspace width="0.167em"></mspace><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>+</mo><msub><mi>h</mi><mi>j</mi></msub><mo>,</mo><mspace width="0.167em"></mspace><mi>‚Ä¶</mi><mo>,</mo><mspace width="0.167em"></mspace><msubsup><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x_{1}^{(i)},\, \ldots, \, x_{j}^{(i)}+h_{j},\, \ldots, \, x_{p}^{(i)})</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>j</mi></msub><annotation encoding="application/x-tex">h_{j}</annotation></semantics></math>
is added to the feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_{j}</annotation></semantics></math>.<br></p>
</div>
<div class="section level4">
<h4 id="bivariate-feature-effects">Bivariate Feature Effects<a class="anchor" aria-label="anchor" href="#bivariate-feature-effects"></a>
</h4>
<p>This is just the extension of the univariate FME to two features
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>j</mi></msub><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">x_{j}, x_{k}</annotation></semantics></math>
that are affected simultaneously by a step. Therefore, the step size
becomes a vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùê°</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>h</mi><mi>j</mi></msub><mo>,</mo><msub><mi>h</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{h} = (h_{j}, h_{k})</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>j</mi></msub><annotation encoding="application/x-tex">h_{j}</annotation></semantics></math>
denotes the change in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_{j}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>k</mi></msub><annotation encoding="application/x-tex">h_{k}</annotation></semantics></math>
the change in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>k</mi></msub><annotation encoding="application/x-tex">x_{k}</annotation></semantics></math>:<br><br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">FME</mtext><mrow><msup><mi>ùê±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><mspace width="0.167em"></mspace><mi>ùê°</mi></mrow></msub><mo>=</mo><mover><mi>f</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>x</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>,</mo><mspace width="0.167em"></mspace><mi>‚Ä¶</mi><mo>,</mo><mspace width="0.167em"></mspace><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>+</mo><msub><mi>h</mi><mi>j</mi></msub><mo>,</mo><mspace width="0.167em"></mspace><mi>‚Ä¶</mi><mo>,</mo><mspace width="0.167em"></mspace><msubsup><mi>x</mi><mi>k</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>+</mo><msub><mi>h</mi><mi>k</mi></msub><mo>,</mo><mspace width="0.167em"></mspace><mi>‚Ä¶</mi><mo>,</mo><msubsup><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mover><mi>f</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ùê±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\textrm{FME}_{\mathbf{x}^{(i)}, \, \mathbf{h}} = \widehat{f}(x_{1}^{(i)},\, \ldots, \, x_{j}^{(i)}+h_{j},\, \ldots, \, x_{k}^{(i)}+h_{k}, \, \ldots, x_{p}^{(i)})-\widehat{f}(\mathbf{x}^{(i)})</annotation></semantics></math><br></p>
</div>
</div>
<div class="section level3">
<h3 id="categorical-features">Categorical Features<a class="anchor" aria-label="anchor" href="#categorical-features"></a>
</h3>
<p>Equivalent to the step size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>j</mi></msub><annotation encoding="application/x-tex">h_{j}</annotation></semantics></math>
of a numerical feature, we select the category of interest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mi>h</mi></msub><annotation encoding="application/x-tex">c_{h}</annotation></semantics></math>
for a categorical feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_{j}</annotation></semantics></math>.
For a given observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and category
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mi>h</mi></msub><annotation encoding="application/x-tex">c_{h}</annotation></semantics></math>,
the FME is:<br><br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">FME</mtext><mrow><msup><mi>ùê±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><mspace width="0.167em"></mspace><msub><mi>c</mi><mi>h</mi></msub></mrow></msub><mo>=</mo><mover><mi>f</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>c</mi><mi>h</mi></msub><mo>,</mo><mspace width="0.167em"></mspace><msubsup><mi>ùê±</mi><mrow><mo>‚àí</mo><mi>j</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mover><mi>f</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ùê±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="0.167em"></mspace><mspace width="0.167em"></mspace><mspace width="0.167em"></mspace><mspace width="0.167em"></mspace><mspace width="0.167em"></mspace><mspace width="0.167em"></mspace><mspace width="0.167em"></mspace><mspace width="0.167em"></mspace><msub><mi>x</mi><mi>j</mi></msub><mo>‚â†</mo><msub><mi>c</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">\textrm{FME}_{\mathbf{x}^{(i)}, \, c_{h}} = \widehat{f}(c_{h},\, \mathbf{x}_{-j}^{(i)})-\widehat{f}(\mathbf{x}^{(i)}), \, \, \, \, \, \, \, \,x_{j} \neq c_{h}</annotation></semantics></math><br></p>
<p>where we simply change the categorical feature to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mi>h</mi></msub><annotation encoding="application/x-tex">c_{h}</annotation></semantics></math>,
leave all other features
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>ùê±</mi><mrow><mo>‚àí</mo><mi>j</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">\mathbf{x}_{-j}^{(i)}</annotation></semantics></math>
unchanged, and compare the predicted value of this changed observation
to the predicted value of the unchanged observation. Obviously, we can
only compute this for observations where the original category is not
the category of interest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>j</mi></msub><mo>‚â†</mo><msub><mi>c</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">x_{j} \neq c_{h}</annotation></semantics></math>.
See <a href="https://holgstr.github.io/fmeffects/articles/fmeffects.html#categorical-features">here</a>
for an example.</p>
</div>
<div class="section level3">
<h3 id="average-marginal-effects-ame">Average Marginal Effects (AME)<a class="anchor" aria-label="anchor" href="#average-marginal-effects-ame"></a>
</h3>
<p>The AME is the mean of every observation‚Äôs FME as a global estimate
for the feature effect:<br><br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">AME</mtext><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><msubsup><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mrow><mspace width="0.167em"></mspace><msub><mtext mathvariant="normal">FME</mtext><mrow><msup><mi>ùê±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><mspace width="0.167em"></mspace><msub><mi>h</mi><mi>j</mi></msub></mrow></msub></mrow></mrow><annotation encoding="application/x-tex">\textrm{AME} = \frac{1}{n}\sum_{i = 1}^{n}{\, \textrm{FME}_{\mathbf{x}^{(i)}, \, h_{j}}}</annotation></semantics></math><br></p>
<p>Therefore, the AME is the expected difference in the predicted target
variable if the feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_{j}</annotation></semantics></math>
is changed by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>j</mi></msub><annotation encoding="application/x-tex">h_{j}</annotation></semantics></math>
units. For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>j</mi></msub><annotation encoding="application/x-tex">h_{j}</annotation></semantics></math>
= 1, this corresponds to the way we interpret the coefficient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\beta_{j}</annotation></semantics></math>
of a linear regression model. However, be careful: the choice of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>j</mi></msub><annotation encoding="application/x-tex">h_{j}</annotation></semantics></math>
can have a strong effect on the estimated FMEs and AME for
<strong>non-linear</strong> prediction functions, auch as random forests
or gradient-boosted trees.<br></p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="why-we-need-fmes">Why we need FMEs<a class="anchor" aria-label="anchor" href="#why-we-need-fmes"></a>
</h2>
<p>Marginal effects (ME) are already a widely used concept to interpret
statistical models. <strong>However, we believe they are ill-suited to
interpret feature effects in most ML models. Here, we explain why you
should abandon MEs in favor of FMEs:</strong><br>
In most implementations (e.g., Leeper‚Äôs <a href="https://thomasleeper.com/margins/" class="external-link">margins</a> package), MEs are
computed as numerical approximation of the partial derivative of the
prediction function w.r.t. the feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_{j}</annotation></semantics></math>.
In other words, they compute a finite difference quotient, similar to
this:<br><br><span class="math inline">$\textrm{dME}_{\mathbf{x}^{(i)}, \, j} =
\cfrac{\widehat{f}(x_{1}^{(i)}, \, \ldots,\, x_{j}^{(i)}+h,\, \ldots, \,
x_{p}^{(i)})-\widehat{f}(\mathbf{x}^{(i)})}{h}$</span><br></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
typically is <em>very small</em>
(e.g.¬†10<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow></mrow><mrow><mo>‚àí</mo><mn>7</mn></mrow></msup><annotation encoding="application/x-tex">{}^{-7}</annotation></semantics></math>).
As is explained <a href="https://arxiv.org/abs/2201.08837" class="external-link">here</a>,
these derivative-based MEs (dME) have a number of shortcomings:</p>
<p><strong>Number 1:</strong> The formula above computes an estimate for
the partial derivative, i.e., the tangent of the prediction function at
point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ùê±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\mathbf{x}^{(i)}</annotation></semantics></math>.
The default way to interpret this is to say: <em>if</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_{j}</annotation></semantics></math><em>increases by one unit, the predicted target variable can be expected
to increase by</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mtext mathvariant="normal">ME</mtext><mrow><msup><mi>ùê±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><mspace width="0.167em"></mspace><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\textrm{ME}_{\mathbf{x}^{(i)}, \, j}</annotation></semantics></math>.
Unconsciously, we use a unit change
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
= 1) to interpret the computed ME even though we computed an
instantaneous rate of change. <strong>For non-linear prediction
functions, this can lead to substantial misinterpretations.</strong> The
image below illustrates this:</p>
<p><img src="figures%2Fdme_error.png" style="width:50.0%"></p>
<p>The yellow line is the prediction function, the grey line is the
tangent at point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
= 0.5. If interpreted with a unit change, the dME is subject to an
error, due to the non-linearity of the prediction function. The FME,
however, corresponds to the true change in prediction along the secant
(green line) between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
= 0.5 and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
= 1.5. This is simply by way of design of the FME, as it describes
exactly our intuition of interpreting partial derivatives.<br></p>
<p><strong>Number 2:</strong> In general, dMEs are ill-suited to
describe models based on piecewise constant prediction functions (e.g.,
CART, random forests or gradient-boosted trees), as most observations
are located on piecewise constant parts of the prediction function where
the derivative equals zero. In contrast, FMEs allow for the choice of a
sensible step size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
that is large enough to traverse a jump discontinuity, as can be seen in
the example below: At
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
= -2.5 (green), the dME is zero. Using the FME with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
= 1, we get the red point with a different (lower) function value. Here,
the FME is negative, corresponding to what happens when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
= -2.5 increases by one unit.</p>
<p><img src="figures%2Fpiecewise_constant.png" style="width:48.0%"></p>
<p>In a way, the FME is the much smarter, little brother of the
dME:<br></p>
<ul>
<li>it describes the exact behavior of the prediction function</li>
<li>its design corresponds to the way we naturally want to interpret a
partial derivative</li>
<li>through the flexible choice of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>,
it can be tailored to answer the desired research question</li>
<li>it is conceptually simple: researchers can discuss the
interpretations because they understand how they are computed</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Scholbeck, Christian A., et al.¬†‚ÄúMarginal Effects for Non-Linear
Prediction Functions.‚Äù arXiv preprint arXiv:2201.08837 (2022).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Holger L√∂we, Christian Scholbeck.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
